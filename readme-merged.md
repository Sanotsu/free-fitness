## 说明

### 2023-11-16 dietary 和 training 合并之后的继续处理

#### 2023-11-16

- 重新整理和优化了 DBDietaryHelper 和 DBTrainingHelper 数据库工具类
- 集中并重新编写了测试数据插入函数，并统一先放置在“我的”模块中
- 修改饮食记录报告下方表格会出现溢出的问题
- 修正饮食日记主页下方图表营养素图例的颜色为统一枚举值

开始处理主要界面的布局和文字描述

#### 2023-11-17

- 整理了 constants 文件的内容，把 CusLabel、ExerciseDefaultOption、CusDropdownOption 类型合并。
- 简单整理了 exercise list 主页面，优化了新增基础活动及其条件查询的表单页面。

#### 2023-11-18

- frombuilder 的输入框和下拉框二次自定义封装，并在 exercise 修改和查询表单中复用。

#### 2023-11-19

- 基本整理好了运动的“动作”模块的所有初步的细节。（导入功能靠后再做）
- 基本整理了训练组模块的首页的布局，新增了查询功能、修改训练基础信息的功能。

#### 2023-11-21

- 饮食模块新增了单独的食物营养素管理子模块，已初步完成
  - 食物列表主页面
  - 食物 json 文件导入(数据和格式来源于《中国食物成分表标准版第 6 版》自己 ocr 识别的截图数据)
  - 食物详情页(展示 OK，**修改、添加新的单份营养素、布局等还没做**)

#### 2023-11-21

- 基本完成了训练组模块内容的重新整理（跟练功能放在最后再做）。

---

### 2023-12-09 阶段总结

2023-12-09 感觉大部分功能都已经完成了，剩下的需要一个个页面进行检查时再改善优化。
先整理一下各个部分之前还剩下的问题。

### 2023-12-12 开始优化和部分细节完善

- 基本完善了饮食日记的首页、添加时的详情页等细节；
- 基本完成运动模块的基本细节。
- 修复了运动的查询时重置无效的问题。

### 2023-12-13

- fix: 不再使用命名路由，修复添加饮食条目返回主页没有重新加载的问题，当摄入量无小数位时不显示小数，简化饮食条目食物详情页面。
- feat: 完成饮食条目食物详情页面的新增单份营养素功能，同时删除旧的营养素详情的代码；fix:删除命名路由相关代码。
- perf:优化了饮食报告页面的部分细节。
- feat:新增了添加饮食记录可以选择最近餐次的摄入记录的食物列表。
- fix:备份恢复添加了加载中指示器。

### 2023-12-14

**【大问题:没有考虑食物成分的删除】-> 训练模块的基础数据也没考虑删除，而且更复杂！！！**

- 删除食物和营养素功能: 那后续饮食记录统计等不就带不出对应的数据了吗？

  - 两个思路:
    - 第一：daily food item 用冗余设计，直接是条目、食物、营养素信息的所有栏位，不用关联查询
    - 第二：逻辑删除，食物成分管理时只显示未逻辑删除的，就不影响已有关联的摄入条目的联合查询。
    - 第三：还是物理删除，但有其他地方使用到的食物不允许删除。
      - 引申出来: **有用到的就逻辑删除、没用到的就物理删除。(这个改动没那么大，也比较合理)**

- feat: 添加了食物成分列表中长按可删除食物及其单份营养素的功能。fix:添加逻辑删除栏位，食物及其单份营养素有被饮食记录条目使用则逻辑删除，否则就物理删除。

- 删除运动相关的基础表逻辑(耦合太多):
  - 因为 exercise 算是主体内容，所有有被使用就不允许删除，具体:
    - exercise(和 action 是 1 对 1，及有关联的 action) 有被 group 使用，则不允许删除；
    - group 有被 plan(及存在与 plan_has_group)使用，则不允许删除；
    - plan 有被训练日志使用，则不允许删除。
      - 训练日志肯定不允许删除；
      - 删除 plan: 从 plan_has_group 中移除该 plan_id 的数据即可。
- 那新问题出现了：用户跟着一个计划或者训练练习了之后，需要调整，就无法调整，只能新增了，因为有日志不允许删除的缘故。
  - 目前的逻辑:
    - 删除 exercise，group 对应的 action 会被删除；
    - 没有删除 group；
    - 没有删除 plan；
      - plan 有训练日志，则不允许跳转其 group list；
- 2023-12-14 目前最简单的处理:**联合查询，有用到的就不允许删除**。可能不合理，但时间不充裕了。

- feat: 新增训练、计划列表中长按删除；添加了动作、训练、计划在删除前检查是否有被使用的逻辑，有被使用则不支持删除。

### 2023-12-15

- feat:添加应用图标，修改应用名称，测试打包效果。fix:无数据时体重趋势折线图绘制异常。
- refactor:重构了用户基本信息的预览页和修改页。perf:优化了首次使用的初始化页面.feat:新增了运动模块的部分 i10n 的中英文显示。

### 2023-12-16

- feat:添加更多设置模块，添加切换中英文显示的按钮。fix:修复无训练记录是运动报告统计报错的问题。
- feat:完成用户与设置模块中摄入目标、运动设置、备份恢复、更多设置相关页面的中英文切换的多语言支持。

### 2023-12-18

- feat:完成用户与设置模块中基本信息、体重趋势相关页面的中英文切换的多语言支持。
- feat:体重趋势中体重记录添加了日期范围查询。
- feat:完成手记模块的相关页面的中英文切换的多语言支持,添加长按 tile 删除指定手记的功能。fix:修正手记分类为单选、心情标签为多选。

### 2023-12-19

- fix:手记查询时筛选为当前用户的数据；feat:时间线模式添加关键字查询功能。
- feat:基本完成饮食模块的食物组成相关页面的中英文切换的多语言支持;fix:完成单份营养素详细的修改功能。

### 2023-12-20

- feat:基本完成饮食模块的饮食记录、餐次相册和饮食报告相关页面的中英文切换的多语言支持。

### 2023-12-21

- feat:基本完成运动模块的动作管理子模块相关页面的中英文切换的多语言支持，并修复一些细节 bug。

### 2023-12-22

- feat:基本完成运动模块的训练管理子模块(除了跟练页面)相关页面的中英文切换的多语言支持。
- 跟练还有 bug:已经完成之后的弹窗，点击返回按钮之后，弹窗消失，其他按钮又能够点击了，这样数据就不对。
  - 应该点击了返回，直接就退出才对。

### 2023-12-23

- fix:添加跟练点击返回按钮显示是否终止的确认弹窗，修复跟练结束点击返回按钮会关闭弹窗但还是在跟练结束页面而不是主页面。
- feat:基本完成运动模块的计划管理子模块相关页面的中英文切换的多语言支持，修复部分细节 bug。
- feat:基本完成运动模块的训练报告模块(除导出 pdf 外)相关页面的中英文切换的多语言支持，修缮部分细节 bug。

### 2023-12-25

- feat:基本完成运动模块的训练报告导出 pdf 页面的中英文切换的多语言支持,修复 pdf 一条记录一页而不是按每日训练记录分页的问题。
